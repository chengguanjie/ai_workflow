# 解决"未配置 AI 服务商"错误

## 问题原因

当执行工作流时出现"节点 '替代' 执行失败: 未配置 AI 服务商"错误，主要有以下原因：

1. **没有设置默认的AI服务商** - 系统在查找AI配置时，需要有一个 `isDefault: true` 的配置
2. **工作流节点没有选择特定的AI配置** - 节点的 `aiConfigId` 字段为空
3. **配置状态问题** - AI配置可能被禁用（`isActive: false`）

## 解决方法

### 方法1：设置默认AI服务商（推荐）

1. 进入 **设置 → AI 配置** 页面
2. 找到您已配置的AI服务商
3. 点击该配置右侧的 **"设为默认"** 按钮
4. 看到配置上显示 **"默认"** 标签即表示设置成功

### 方法2：为工作流节点选择特定的AI配置

1. 编辑您的工作流
2. 点击"替代"节点（或其他AI处理节点）
3. 在节点配置面板中，切换到 **"AI 配置"** 标签
4. 在"服务商配置"下拉框中选择您配置的AI服务商
5. 保存工作流

### 方法3：检查AI配置状态

确保您的AI配置：
- 已正确保存（有 API Key）
- 处于激活状态
- 属于当前企业/组织

## 技术细节

系统在执行AI节点时，会按以下顺序查找配置：

1. 首先查找节点指定的 `aiConfigId`
2. 如果节点没有指定，则查找组织的默认配置（`isDefault: true` 且 `isActive: true`）
3. 如果都没有找到，则抛出"未配置 AI 服务商"错误

相关代码位于：
- 节点处理器：`src/lib/workflow/processors/process.ts:31`
- 配置查询：`src/lib/workflow/processors/process.ts:178-186`

## 预防措施

1. **始终设置一个默认AI配置** - 这样新创建的节点会自动使用默认配置
2. **定期检查配置状态** - 确保配置处于激活状态
3. **测试配置连接** - 使用"测试"按钮验证API Key是否有效